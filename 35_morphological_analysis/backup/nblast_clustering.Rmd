---
title: "Hierarchical clustering using NBLAST"
output: html_notebook
---


```{r}
library(nat)
library(nat.nblast)
# part of the full neurons for test
# neuronIdList <- c(79695, 77807, 78406, 79044, 77264, 79072, 79907, 77902, 76922, 79503, 77651, 77449, 77580, 77684, 76749, 78874, 77237, 78880, 77121, 78116, 79170, 76389, 79464, 76700, 77056, 76667, 79055, 79058, 78650, 79951, 77092, 78256, 77942, 76697, 78226, 76469, 77592, 76750, 79811, 77872, 76952, 78572, 76887, 77446, 78233, 78545, 79896, 76454, 77900, 78667, 76924, 78351, 76618, 76677, 77393, 76210, 78883, 78601, 77132, 77146, 78696, 79227, 77909, 78586, 77455, 76539, 77142, 76464, 78158, 76682, 77656, 76570, 77152, 79865, 76201, 79458, 76871, 78157, 76912, 77395, 77805, 77342, 78825, 76626, 78086, 77021, 78914, 76541, 77024, 77885, 77098, 76942, 77349, 79734, 77101, 77441, 79510, 76834, 79722, 78346, 78543, 78143, 78083, 76629, 78246, 79893, 78421, 77910, 78633, 78841, 77944, 78453, 76457, 77914, 77057, 78123, 79046, 78544, 79920, 76187, 77946, 76940)

# all the full neurons of 20180703 consensus
# neuronIdList <- c(79695, 77807, 78406, 79044, 77264, 79072, 79907, 77902, 76922, 79503, 77651, 77449, 77580, 77684, 76749, 78874, 77237, 78880, 77121, 78116, 79170, 76389, 79464, 76700, 77056, 76667, 79055, 79058, 78650, 79951, 77092, 78256, 77942, 76697, 78226, 76469, 77592, 76750, 79811, 77872, 76952, 78572, 76887, 77446, 78233, 78545, 79896, 76454, 77900, 78667, 76924, 78351, 76618, 76677, 77393, 76210, 78883, 78601, 77132, 77146, 78696, 79227, 77909, 78586, 77455, 76539, 77142, 76464, 78158, 76682, 77656, 76570, 77152, 79865, 76201, 79458, 76871, 78157, 76912, 77395, 77805, 77342, 78825, 76626, 78086, 77021, 78914, 76541, 77024, 77885, 77098, 76942, 77349, 79734, 77101, 77441, 79510, 76834, 79722, 78346, 78543, 78143, 78083, 76629, 78246, 79893, 78421, 77910, 78633, 78841, 77944, 78453, 76457, 77914, 77057, 78123, 79046, 78544, 79920, 76187, 77946, 76940, 77848, 77150, 77374, 76923, 76691, 77120, 77435, 77607, 78877, 76748, 78443, 78925, 79067, 79060, 78829, 79747, 77806, 79255, 77816, 77456, 76933, 76614, 76181, 76625, 79763, 79720, 77241, 77140, 78297, 79708, 77240, 76184, 76660, 77821, 77935, 76688, 77083, 77461, 77369, 77868, 78255, 78104, 78858, 77344, 77124, 79022, 76540, 79211, 78241, 77034, 77354, 76931, 77907, 77341, 78847, 78299, 79078, 78939, 77336, 79866, 77261, 78870, 78097, 77058, 78099, 76907, 79059, 76612, 76622, 77329, 78167, 77447, 77239, 76560, 78112, 78151, 79852, 77375, 77591, 77390, 77389, 77899, 76955, 77937, 79042, 78121, 77815, 78356, 76610, 76661, 76631, 77467, 77048, 78254, 77255, 77364, 76751, 77930, 76692, 79054, 79362, 78321, 79214, 77260, 79746, 78641, 77084, 77799, 77162, 77912, 78404, 77927, 77352, 78062, 76950, 78441, 77357, 77122, 79085, 77054, 79921, 76623, 77460, 77826, 78127, 77889, 77373, 76930, 76885, 77327, 78887, 76948, 76197, 79033, 78103, 77933, 76972, 76627, 77797, 77621, 79756, 78540, 76656, 77602, 78868, 77636, 78629, 79074, 77645, 76561, 76543, 79062, 76468, 77039, 76690, 77163, 77945, 77126, 76655, 77022, 77027, 78649, 78119, 77442, 76551, 77434, 77822, 78124, 77689, 79048, 78125, 76938, 77845, 76192, 77079, 77936, 78338, 77020, 79879, 76918, 77890, 76953, 76903, 77581, 78150, 79225, 77896, 77091, 78358, 77803, 76679, 79948, 76606, 78052, 78426, 76673, 77238, 76964, 78088, 77844, 76886, 79069, 78095, 76936, 76943, 77465, 77081, 78949, 77895, 76701, 78357, 77740, 77232)

# orphan axon IDs
neuronIdList <- c(79475, 78953, 78979, 79804, 79132, 76675, 78096, 78826, 77757, 79855, 78634, 78415, 77471, 77457, 79484, 77019, 78131, 79482, 78173, 78969, 78807, 79738, 79673, 79182, 77377, 78856, 79165, 79767, 78800, 78926, 78864, 78851, 77394, 78275, 78684, 78961, 79195, 79159, 78091, 77392, 79209, 77263, 78418, 79764, 79918, 79207, 77032, 79517, 77472, 79193, 79779, 78647, 77331, 77348, 78136, 77850, 79468, 77778, 79959, 79770, 76787, 77858, 79677, 79892, 79184, 79663, 76941, 79742, 76654, 78694, 78839, 79792, 78657, 78176, 79121, 77386, 78908, 79864, 79676, 78675, 78965, 79880, 79537, 79928, 78185, 77842, 78762, 78955, 78631, 78962, 78332, 78836, 79226, 79647, 77741, 78245, 78354, 78805, 79696, 79745, 78912, 79197, 78273, 76844, 79142, 79835, 79020, 78340, 79743, 79262, 79512, 79831, 79651, 77819, 79119, 79524, 79546, 78817, 77744, 79819, 79509, 77753, 78770, 78293, 77820, 79483, 78595, 77047, 77772, 78184, 77304, 79516, 78831, 78824, 78132, 77378, 77376, 78341, 78796, 79949, 77459, 78785, 78181, 77771, 76966, 79521, 79737, 78936, 78916, 78350, 79469, 79147, 77445, 77339, 79189, 78643, 78630, 79861, 78828, 79126, 76630, 78846, 76619, 78621, 79309, 78680, 79847, 77444, 77026, 78627, 79799, 77849, 78262, 79144, 79470, 79871, 78178, 79456, 78140, 79196, 78637, 77792, 76928, 78802, 79878, 79828, 78654, 79815, 78900, 77452, 79152, 78761, 77755, 76929, 79507, 77385, 77742, 78154, 77466, 78655, 79943, 78644, 77767, 79467, 77018, 77235, 78799, 78169, 79501, 78267, 79200, 79513, 79714, 77751, 77852, 78832, 79151, 78107, 79669, 78610, 77326, 79724, 76777, 78304, 76681, 77748, 79780, 79854, 79177, 76781, 79169, 79844, 79678, 79912, 79117, 79884, 78162, 78598, 79979, 78100, 79224, 79803, 77044, 78985, 79719, 79545, 78308, 79122, 76774, 79675, 76906, 78787, 78597, 79970, 78231, 78697, 77303, 78910, 79168, 79731, 78664, 79518, 78837, 77824, 79498, 78983, 79173, 79248, 79562, 77817, 77810, 79957, 78681, 78889, 78958, 78982, 77332, 79257, 78175, 77358, 79462, 79975, 77754, 78884, 79141, 78773, 79668, 79833, 78833, 79682, 78142, 79712, 77350, 78821, 78834, 76927, 78897, 79492, 78613, 77770, 77773, 78615, 78141, 79491, 76636, 78791, 79713, 79459, 79808, 78840, 78682, 77745, 77782, 77462, 78622, 78903, 79145, 78907, 78298, 79515, 78236, 79825, 79208, 78237, 79153, 79886, 78865, 78835, 78966, 79576, 79781, 79656, 78905, 79748, 77827, 77756, 78608, 76779, 79505, 78918, 76956, 78781, 78882, 78971, 78698, 78672, 78179, 77779, 79221, 77758, 78687, 78779, 79877, 76932, 77368, 79527, 78968, 76949, 79666, 78260, 79481, 78635, 79765, 77870, 78349, 78838, 78348, 77251, 78172, 78102, 78269, 78258, 78947, 79945, 78699, 78106, 77865, 79457, 79477, 78857, 77774, 77366, 79155, 78666, 79930, 76962, 77743, 76666, 76849, 78054, 78978, 79175, 76957, 79172, 79157, 77262, 78924, 78935, 78333, 77463, 78617, 79848, 79233, 78957, 79853, 79156, 77811, 79758, 77391, 78701, 77259, 79326, 79139, 77862, 78313, 79885, 77448, 79043, 78896, 78243, 79129, 79793, 78940, 79849, 79540, 78113, 78166, 79807, 78663, 78972, 79455, 79461, 77864, 78126, 79136, 78964, 79932, 78810, 79810, 79259, 79704, 79154, 78777, 78624, 79460, 78901, 79664, 78653, 79683, 79205, 78240, 79963, 76538, 78872, 79204, 79691, 78155, 79642, 77031, 78174, 79166, 79941, 77298, 78899, 79728, 79544, 78188, 79529, 77863, 78280, 78855, 78626, 78282, 78820, 78120, 78089, 78813, 79702, 76621, 79813, 76921, 77768, 78677, 78133, 78693, 78960, 79851, 79816, 79794, 76846, 78909, 77857, 79707, 78894, 78904, 78980, 79802, 79894, 77353, 78665, 79956, 78618, 79520, 78129, 79465, 78130, 76620, 76694, 79927, 79536, 76926, 79801, 79776, 78783, 78850, 79946, 76843, 76773, 78148, 78604, 79150, 78776, 79786, 78163, 79194, 79185, 78923, 77766, 78301, 77809, 79149, 79543, 78310, 79161, 79751, 79130, 78619, 79827, 79201, 77030, 79968, 78848, 79913, 78274, 79215, 78171, 76776, 78229, 78111, 79192, 78232, 77765, 77802, 77775, 79902, 79658, 77794, 78168, 79478, 79812, 79690, 79533, 76784, 77825, 79672, 79736, 78277, 78628, 79823, 78110, 79163, 79735, 78797, 79699, 76783, 78335, 78328, 77746, 79939, 78056, 78702, 78259, 78134, 79680, 76684, 78852, 78146, 79965, 78948, 79768, 78339, 78144, 79969, 79860, 77846, 76698, 78668, 77759, 79881, 77660, 78766, 79869, 78808, 79202, 76670, 78270, 79523, 78878, 78347, 78863, 78320, 78230, 79817, 78227, 77370, 79705, 78092, 79662, 78814, 78307, 78359, 78317, 78670, 78827, 79759, 78594, 78970, 79133, 79494, 76628, 78695, 79800, 77399, 79936, 76288, 77384, 78235, 78090, 79744, 77750, 79958, 76925, 79726, 77829, 78849, 78876, 77371, 79164, 78616, 79206, 79721, 78253, 79718, 78355, 77873, 79649, 77328, 77780, 78782, 79887, 79700, 79124, 76778, 76915, 78652, 79905, 78651, 78152, 77869, 78816, 76659, 79222, 79657, 79908, 77464, 79830, 78956, 78139, 78343, 79488, 78239, 79859, 79834, 78345, 78778, 78830, 78238, 78177, 79709, 79937, 78094, 78794, 77823, 76786, 78656, 79128, 76632, 79829, 78303, 78596, 78318, 78973, 79565, 79820, 79883, 79216, 79134, 77818, 77828, 79796, 79706, 78886, 79135, 78261, 78160, 76664, 79210, 77254, 78602, 79123, 79684, 79858, 79661, 77338, 78853, 78632, 79219, 79453, 76693, 77355, 79730, 78844, 78266, 79916, 77372, 77855, 78981, 79500, 78268, 79480, 77025, 78804)

# known type classification
# AbdR  77648 77710 77300 77705 77305 77301 77709 77672 77302 
# AbdC  77154 77646 77682 77628 77295 77297 77652 77292 77688 77654 77658 77657 77662 77296 
# ABDiR  77631 77150 77618 77886 78547 77158 78556 78552 77665 77668 77634 78553  
# ABDiC  77148 77625 77641 77692 77144 77643 77640 79051 79066 78574
# neuronIdList = c(77648,77710,77300,77705,77305,77301,77709,77672,77302,77154,77646,77682,77628,77295,77297,77652,77292,77688,77654,77658,77657,77662,77296,77631,77150,77618,77886,78547,77158,78556,78552,77665,77668,77634,78553,77148,77625,77641,77692,77144,77643,77640,79051,79066,78574) 


fileNameList = paste0("../01_data/0703/postprocessed/atlas_space/swc/", neuronIdList, ".swc")

neurons = read.neurons(fileNameList)
mydotprops = dotprops(neurons/1e3, resmaple=1, k=20)
# plot3d(mydotprops)

# aba=nblast_allbyall(mydotprops, version=1, sd=3000)
aba = nblast_allbyall(mydotprops)
hc=nhclust(scoremat=aba, method="ward.D")
plot(hc)
# plot3d(hc, k=3, db=mynlist)

memb = cutree(hc, k=11)
write.csv2(memb, file="nblast_memb.csv")
```


